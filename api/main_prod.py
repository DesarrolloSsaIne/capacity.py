import requests
import json
import base64, os
import jwt
import hashlib
import math
import sys
import time
from base64 import b64decode

if __name__=='__main__':

    url = 'https://api.firma.digital.gob.cl/firma/v2/files/tickets'
    exp='2020-06-20T14:59:00'
    otp='759228'

    layout='<AgileSignerConfig><Application id=\"THIS-CONFIG\"><pdfPassword/><Signature><Visible active=\"true\" layer2=\"true\" label=\"true\" pos=\"1\"><llx>50</llx><lly>100</lly><urx>350</urx><ury>200</ury><page>LAST</page><image>BASE64</image><BASE64VALUE>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</BASE64VALUE></Visible></Signature></Application></AgileSignerConfig>'


    tokenDesatendido = jwt.encode({'entity': 'Instituto Nacional de Estadísticas',
                        'run':'10685080',
                        'expiration': exp,
                        'purpose':'Desatendido'},
                        'a08253d568bf46f2a5ef8217dbb06da7', algorithm='HS256').decode('utf-8')

    tokenAtendido = jwt.encode({'entity': 'Instituto Nacional de Estadísticas',
                        'run':'14202112',
                        'expiration': exp,
                        'purpose':'Propósito General'},
                        'a08253d568bf46f2a5ef8217dbb06da7', algorithm='HS256').decode('utf-8')



    with open('doc.pdf', 'rb') as pdf_file: # Convierte a Base64 el documento pdf hasta 20 megas
        pdfb64 = base64.b64encode(pdf_file.read()).decode('utf-8')


    with open('doc.pdf', "rb") as f: # Genera el checksum desde el documento pdf hasta 20 megas
        bytesConv = f.read()
        readable_hash = hashlib.sha256(bytesConv).hexdigest()
        checksum= readable_hash

    archivo = open('layout.txt', 'r')
    archivo=archivo.read()

    files ={'api_token_key':'99c3f6e0-24c9-4c58-a564-dfde158cb987',
            'token':tokenDesatendido, 'files': [{'content-type': 'application/pdf',
             'content': pdfb64, 'description':'Str', 'layout':layout,
             'checksum': checksum}]}




    headers = {'content-type': 'application/json'} # 'OTP':otp     (agregar cuando es atendido)


    response = requests.post(url, data=json.dumps(files), headers=headers)


    if response.status_code==200:

        print(response.status_code)

        response_str=response.text #Estrae la respuesta como str
        response_dic = json.loads(response_str) # la convierte en una estructura json

        files_dic= response_dic['files'][0] #Estrae files
        pdfb64Signed = files_dic['content'] #estraes el content (base64 del archivo firmado)

        pdfSigned = base64.b64decode(str(pdfb64Signed)) # convierte a pdf

        with open(os.path.expanduser('DocumentoFirmadoProd.pdf'), 'wb') as fout: #guarda el pdf en carpeta
            fout.write(pdfSigned)
            fout.close()


    else:
        # print(archivo)
        print(response.status_code)
        print(response.content)
