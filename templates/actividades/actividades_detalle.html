{% extends 'base/base.html' %}

{% block title %}
Actividades Asociadas al Objetivo
{% endblock %}
{% block content %}

{% if messages %}
		  {% for message in messages %}

			<div style="border-radius:0;" {% if message.tags %} id="danger-alert" class="{{request.session.message_class}} fade show mb-0" role="alert" {% endif %}>
			  {{ message }}
			  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
				<span aria-hidden="true">&times;</span>
			  </button>
			</div>

		  {% endfor %}

	{% endif %}



	<section class="panel">
							<header class="panel-heading">
								<div class="panel-actions" >
									<div  >
								    <button  type="button" class="volver btn btn-sm btn-info"  name="button" title="Volver"  data-toggle="tooltip" data-original-title="Tooltip on bottom" data-placement="top">
      								<span class="fa fa-reply"></span></button>
									<button  type="button" class="create btn btn-sm btn-success" id="create" name="button" title="Agregar Nueva Actividad"  data-toggle="tooltip" data-original-title="Tooltip on bottom" data-placement="top" {% if total_disponible.id_controlador.estado_flujo_id == 1 or total_disponible.id_controlador.estado_flujo_id == 2 or total_disponible.id_controlador.estado_flujo_id == 4 or total_disponible.id_controlador.estado_flujo_id == 5 or total_disponible.id_controlador.estado_flujo_id == 6 or total_disponible.id_controlador.estado_flujo_id == 7 or total_disponible.id_controlador.estado_flujo_id == 10 %} disabled {% endif %} >
      								<span class="fa fa-plus"></span></button>
									</div>
								</div>

									<h2  class="panel-title" style="font-size:16px; padding-right:45px;"> {{nombre_objetivo.nombre}} </h2>

							</header>
							<div class="panel-body">
								<table class="table table-bordered table-striped mb-none" id="datatable-default" >
									<thead>
										<tr>
											<th style="font-size:11px;">ID</th>
											<th style="font-size:11px; "> <div style="color:white;">......................................</div> <br> Descripción Actividad </th>
											<th style="font-size:11px;">Periodicidad</th>
											<th style="font-size:11px;">Horas Asoc.</th>
											<th style="font-size:11px;">Volumen</th>
											<th style="font-size:11px;">Personas Asig.</th>
											<th style="font-size:11px;">Total Horas</th>
											<th style="font-size:11px; ">Familia Cargo</th>
											<th style="font-size:11px;">Producto Est.</th>
											<th title="Fecha de Inicio de la Actividad" data-toggle="tooltip" data-original-title="Tooltip on bottom" data-placement="top" style="font-size:11px;">Inicio Actividad</th>
											<th title="Fecha de Término de la Actividad" data-toggle="tooltip" data-original-title="Tooltip on bottom" data-placement="top" style="font-size:11px;">Termino Actividad</th>
<!--											<th title="Total de Observaciones Asociadas a la Actividad" data-toggle="tooltip" data-original-title="Tooltip on bottom" data-placement="top">Obs. Total</th>-->
											<th style="font-size:12px;">Opciones</th>
											<th style="font-size:11px;">Obs.</th>
										</tr>
									</thead>
									<tbody>

                                            {% for  objetivo in object_list %}

                                                <tr>

													<td style="font-size:11px;"> {{ objetivo.id }}</td>
													<td class="Mitexto"  style="height:70px; width:100%; border-bottom:1px; border-left:0px; border-right:0px; font-size:11px; padding-top:-5px;"  >{{ objetivo.descripcion_actividad}}</td>
													<td style="font-size:11px; "> {{ objetivo.id_periodicidad}}</td>
													<td style=" font-size:11px;"> {{ objetivo.horas_actividad}}</td>
													<td style=" font-size:11px;"> {{ objetivo.volumen}}</td>
													<td style=" font-size:11px;"> {{ objetivo.personas_asignadas}}</td>
													<td style=" font-size:11px;"> {{ objetivo.total_horas}}</td>
													<td style=" font-size:11px;">  {{ objetivo.id_familia_cargo}} </td>
													<td class="descripcion_producto"  style="cursor:pointer; max-width: 10px; overflow: hidden;  display: table-cell;  text-overflow: ellipsis;  border: solid 1px #dddddd; white-space: nowrap; font-size:11px;">{% if objetivo.id_producto_estadistico == None %} - {% else %} {{ objetivo.id_producto_estadistico}}{% endif %}</td>
													<td style=" font-size:11px;" ><span style='display: none;'>{{objetivo.fecha_inicio_actividad|date:"Ymd"}}</span>  {{ objetivo.fecha_inicio_actividad}} </td>
													<td style=" font-size:11px;"><span style='display: none;'>{{objetivo.fecha_termino_actividad|date:"Ymd"}}</span>  {{ objetivo.fecha_termino_actividad}}</td>
<!--													<td style="width:50px;"> {% if objetivo.count_observaciones == none %} 0 {% else %} {{ objetivo.count_observaciones}} {%endif%}</td>-->

                                                    <td style="width:80px; align:center; " >



														 <button type="button" title="Editar Actividad" title="Fecha de Inicio de la Actividad" data-toggle="tooltip" data-original-title="Tooltip on bottom" data-placement="top" class="update btn btn-sm btn-primary" data-id="{% url 'RegistroActividadEditar' objetivo.id %}"  {% if total_disponible.id_controlador.estado_flujo_id == 1 or total_disponible.id_controlador.estado_flujo_id == 2 or total_disponible.id_controlador.estado_flujo_id == 4 or total_disponible.id_controlador.estado_flujo_id == 5 or total_disponible.id_controlador.estado_flujo_id == 6 or total_disponible.id_controlador.estado_flujo_id == 7 or total_disponible.id_controlador.estado_flujo_id == 10 %} disabled {% endif %}>
														<span class="fa fa-pencil"></span></button>
														 <button type="button" title="Eliminar Actividad" title="Fecha de Inicio de la Actividad" data-toggle="tooltip" data-original-title="Tooltip on bottom" data-placement="top" class="delete btn btn-sm btn-danger" data-id="{% url 'RegistroActividadesEliminar' objetivo.id %}" {% if total_disponible.id_controlador.estado_flujo_id == 1 or total_disponible.id_controlador.estado_flujo_id == 2 or total_disponible.id_controlador.estado_flujo_id == 4 or total_disponible.id_controlador.estado_flujo_id == 5 or total_disponible.id_controlador.estado_flujo_id == 6 or total_disponible.id_controlador.estado_flujo_id == 7 or total_disponible.id_controlador.estado_flujo_id == 10 %} disabled {% endif %}>
      													  <span class="fa fa-trash-o"></span></button>
													</td>


													  <td style="width:40px; text-align:center;">


                                                          <button type="button"  title="Observaciones a la Actividad" title="Fecha de Inicio de la Actividad" data-toggle="tooltip" data-original-title="Tooltip on bottom" data-placement="top" id="notification"  class="update btn btn-sm btn-primary"  data-id="{% url 'gestionobservacionactividades' objetivo.id %}"  {% if total_disponible.id_controlador.estado_flujo_id == 1 or total_disponible.id_controlador.estado_flujo_id == 2 or total_disponible.id_controlador.estado_flujo_id == 4 or total_disponible.id_controlador.estado_flujo_id == 5 or total_disponible.id_controlador.estado_flujo_id == 6 or total_disponible.id_controlador.estado_flujo_id == 7 or total_disponible.id_controlador.estado_flujo_id == 10 %} disabled {% endif %} >
														  <span class="fa fa-comments" ></span>
                                                               {% if objetivo.count_no_vistos != 0 and objetivo.count_no_vistos != none %} <span class="badge" title="Nuevas Observaciones a la actividad" data-toggle="tooltip" data-original-title="Tooltip on bottom" data-placement="bottom" >{{ objetivo.count_no_vistos }}</span> {% endif %}
														  </button>
                                                    </td>


                                                </tr>

                                            {% endfor %}


									</tbody>
								</table>
																<div align="left" style="margin-right:20px;" >
							<h5 style="color:#1e7799;">Total horas disponible área:	<b>{{total_disponible.total_horas}}</b> | Total Horas Disponibles: <b>{{total_disponible.total_utilizado}}</b> | Total horas y Porcentaje de Carga Programada: <b>{{total_disponible.consumidas}}({{total_disponible.avance_porcentaje}}%)</b></h5>
								<input id="total_disponible_id"  type="hidden" value="{{ total_disponible.total_utilizado }}">
																</div>
							</div>
						</section>




<!--Cabecera del modal -->

<div class="modal fade"  tabindex="-1" role="dialog" id="modalCreate">
  <div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">

    </div>
  </div>
</div>

<div class="modal fade" tabindex="-1" data-backdrop="static"
  data-keyboard="false" role="dialog"  id="modalUpdate">
  <div class="modal-dialog modal-lg" role="document">
	<div class="modal-content">

    </div>
  </div>
</div>


<div class="modal fade" tabindex="-1" role="dialog" id="modalDelete">
  <div class="modal-dialog modal-xs" role="document">
	<div class="modal-content">

    </div>
  </div>
</div>




<!--Fin cabecera del modal -->
        <div class="modal fade" id="observacion_center" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">

				<header class="panel-heading">
				<div class="panel-actions">
				<a class="fa fa-times" data-dismiss="modal"></a>
				</div>
				<h2 class="panel-title">Detalle Actividad</h2>
			</header>

              <div class="modal-body">
               	<textarea id="txt_obs_campo_expand" rows="15" cols="80" class="form-control" style="width:100%;resize: none; " maxlength="5000" readonly  ></textarea>

              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>

              </div>
            </div>
          </div>

        </div>

        <div class="modal fade" id="observacion_center_prod" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">

				<header class="panel-heading">
				<div class="panel-actions">
				<a class="fa fa-times" data-dismiss="modal"></a>
				</div>
				<h2 class="panel-title">Detalle Actividad</h2>
			</header>

              <div class="modal-body">
               	<textarea id="txt_obs_campo_expand_prod" rows="15" cols="80" class="form-control" style="width:100%;resize: none; " maxlength="5000" readonly  ></textarea>

              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>

              </div>
            </div>
          </div>

        </div>



	{% block extrajs %}




<script type="text/javascript">


$(".volver").click(function() {
    window.location.href = '{% url 'ActividadesObjetivosListar'  %}';
    return false;
});

	// JS modal crea Registro
  	 $(".create").modalForm(  {formURL: "{% url 'ActividadesCrear' %}", modalID: $("#modalCreate")});

    // JS modal crear Registro
   // $(".create").each(function () {
   // $(this).modalForm({formURL: $(this).data('id'),  modalID: $("#modalCreate")});
	//});


   	 // JS modal actualiza Registro
   $(".update").each(function () {
   $(this).modalForm({formURL: $(this).data('id'),  modalID: $("#modalUpdate")});

    });




    // JS modal elimina Registro
    $(".delete").each(function () {
    $(this).modalForm({formURL: $(this).data('id'),  modalID: $("#modalDelete")});
	});





     // Js Muestra/Oculta Mensaje Success
   	 $(".alert").fadeTo(8000, 500).slideUp( "slow", function() {
     $(this).remove();
  });



$('#datatable-default').on('click', '.Mitexto', function () {

    $('#txt_obs_campo_expand').val($(this).parents('tr').find('td:nth-child(2)').text())
    $('#observacion_center').modal('toggle');
});

$('#datatable-default').on('click', '.descripcion_producto', function () {

    $('#txt_obs_campo_expand_prod').val($(this).parents('tr').find('td:nth-child(9)').text())
    $('#observacion_center_prod').modal('toggle');
});





$('#datatable-default').DataTable( {

	stateSave: true,
   "order":  [ 10, "asc" ],

   "pageLength": 50 // cambio a 50 sprint 1 - CI-11 - 070121
} );



</script>

		{% endblock %}



{% endblock %}
